<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Calendario de Comidas</title>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 20px;
Â  Â  Â  background-color: #f4f4f9;
Â  Â  }
Â  Â  h1, h2 {
Â  Â  Â  color: #333;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .buttons-container {
Â  Â  Â  display: flex;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  justify-content: center;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  button {
Â  Â  Â  background-color: #4285f4;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 12px 24px;
Â  Â  Â  text-align: center;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-size: 16px;
Â  Â  Â  margin: 5px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â  Â  Â  transition: background-color 0.3s ease;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background-color: #357ae8;
Â  Â  }
Â  Â  #save-button {
Â  Â  Â  background-color: #34a853;
Â  Â  }
Â  Â  #save-button:hover {
Â  Â  Â  background-color: #2b8c45;
Â  Â  }
Â  Â  .container {
Â  Â  Â  background-color: white;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
Â  Â  Â  max-width: 95%;
Â  Â  Â  overflow-x: auto;
Â  Â  }
Â  Â  table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â  th, td {
Â  Â  Â  /* Bordes mÃ¡s visibles */
Â  Â  Â  border: 3px solid #666;
Â  Â  Â  padding: 12px;
Â  Â  Â  text-align: left;
Â  Â  Â  white-space: nowrap;
Â  Â  Â  min-width: 100px;
Â  Â  }
Â  Â  th {
Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  color: #555;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  /* Estilos para la celda activa */
Â  Â  td[contenteditable="true"]:focus,
Â  Â  .selected-cell {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: #3b82f6;
Â  Â  Â  box-shadow: 0 0 8px rgba(59, 130, 246, 0.7);
Â  Â  }
Â  Â  #status-message {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  font-style: italic;
Â  Â  Â  color: #777;
Â  Â  Â  text-align: center;
Â  Â  }
Â  </style>
Â  <script src="https://apis.google.com/js/api.js"></script>
Â  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
Â  <h1>Calendario de Comidas</h1>

Â  <div class="buttons-container">
Â  Â  <button id="login">Iniciar sesiÃ³n con Google</button>
Â  Â  <button id="logout" style="display:none">Cerrar sesiÃ³n</button>
Â  Â  <button id="save-button" style="display:none">Guardar Cambios</button>
Â  </div>

Â  <div id="contenido" class="container" style="display:none">
Â  Â  <h2>Datos del mes</h2>
Â  Â  <div id="resultado"></div>
Â  Â  <div id="status-message"></div>
Â  </div>

Â  <script>
Â  Â  const CLIENT_ID = "688826321509-sb3n6gt3mpusmbvorsgdnketbbb1a25b.apps.googleusercontent.com";
Â  Â  // La clave de API ha sido eliminada por seguridad. La autenticaciÃ³n se maneja con el token de OAuth.
Â  Â  const SPREADSHEET_ID = "11_kq2qaKl2f2awWh0ea1IUelHmqUKDyyU6apbZvWbyo";
Â  Â  const RANGE = "Setembre25!A1:D91";
Â  Â  const SCOPE = "https://www.googleapis.com/auth/spreadsheets";

Â  Â  let token = null;

Â  Â  gapi.load("client", async () => {
Â  Â  Â  console.log("âœ… gapi.client cargado");
Â  Â  Â  await gapi.client.init({
Â  Â  Â  Â  // La clave de API ya no es necesaria aquÃ­.
Â  Â  Â  Â  discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
Â  Â  Â  });
Â  Â  Â  console.log("âœ… gapi.client inicializado");
Â  Â  });

Â  Â  function login() {
Â  Â  Â  console.log("ğŸ”‘ Iniciando login...");
Â  Â  Â  google.accounts.oauth2.initTokenClient({
Â  Â  Â  Â  client_id: CLIENT_ID,
Â  Â  Â  Â  scope: SCOPE,
Â  Â  Â  Â  callback: (resp) => {
Â  Â  Â  Â  Â  console.log("âœ… Token recibido:", resp);
Â  Â  Â  Â  Â  token = resp.access_token;
Â  Â  Â  Â  Â  gapi.client.setToken({ access_token: token });

Â  Â  Â  Â  Â  document.getElementById("login").style.display = "none";
Â  Â  Â  Â  Â  document.getElementById("logout").style.display = "block";
Â  Â  Â  Â  Â  document.getElementById("save-button").style.display = "block";
Â  Â  Â  Â  Â  document.getElementById("contenido").style.display = "block";

Â  Â  Â  Â  Â  leerDatos();
Â  Â  Â  Â  }
Â  Â  Â  }).requestAccessToken();
Â  Â  }

Â  Â  function logout() {
Â  Â  Â  console.log("ğŸšª Logout");
Â  Â  Â  token = null;
Â  Â  Â  document.getElementById("login").style.display = "block";
Â  Â  Â  document.getElementById("logout").style.display = "none";
Â  Â  Â  document.getElementById("save-button").style.display = "none";
Â  Â  Â  document.getElementById("contenido").style.display = "none";
Â  Â  Â  document.getElementById("resultado").innerHTML = "";
Â  Â  Â  document.getElementById("status-message").innerHTML = "";
Â  Â  }

Â  Â  async function leerDatos() {
Â  Â  Â  document.getElementById("status-message").innerHTML = "Cargando datos...";
Â  Â  Â  console.log("ğŸ“– Leyendo datos de la hoja...");
Â  Â  Â  try {
Â  Â  Â  Â  const response = await gapi.client.sheets.spreadsheets.values.get({
Â  Â  Â  Â  Â  spreadsheetId: SPREADSHEET_ID,
Â  Â  Â  Â  Â  range: RANGE
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log("âœ… Respuesta de Sheets:", response);

Â  Â  Â  Â  const filas = response.result.values || [];
Â  Â  Â  Â  if (filas.length === 0) {
Â  Â  Â  Â  Â  document.getElementById("resultado").innerHTML = "<p>No hay datos</p>";
Â  Â  Â  Â  Â  document.getElementById("status-message").innerHTML = "";
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  let tabla = "<table><thead><tr>";
Â  Â  Â  Â  const encabezados = filas[0];
Â  Â  Â  Â  encabezados.forEach(encabezado => {
Â  Â  Â  Â  Â  tabla += `<th>${encabezado || ""}</th>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  tabla += "</tr></thead><tbody>";

Â  Â  Â  Â  for (let i = 1; i < filas.length; i++) {
Â  Â  Â  Â  Â  const fila = filas[i];
Â  Â  Â  Â  Â  tabla += "<tr>";
Â  Â  Â  Â  Â  fila.forEach((celda, j) => {
Â  Â  Â  Â  Â  Â  const editable = (j > 0) ? 'contenteditable="true"' : '';
Â  Â  Â  Â  Â  Â  tabla += `<td ${editable}>${celda || ""}</td>`;
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  tabla += "</tr>";
Â  Â  Â  Â  }

Â  Â  Â  Â  tabla += "</tbody></table>";
Â  Â  Â  Â  document.getElementById("resultado").innerHTML = tabla;
Â  Â  Â  Â  document.getElementById("status-message").innerHTML = "Datos cargados. Haz clic o usa la tecla 'Tab' para editar.";
Â  Â  Â  Â  
Â  Â  Â  Â  // Listener para el resaltado de celdas al hacer clic
Â  Â  Â  Â  const tableElement = document.querySelector("#resultado table");
Â  Â  Â  Â  tableElement.addEventListener('click', (event) => {
Â  Â  Â  Â  Â  const target = event.target;
Â  Â  Â  Â  Â  if (target.tagName === 'TD' || target.tagName === 'TH') {
Â  Â  Â  Â  Â  Â  const previousSelected = document.querySelector('.selected-cell');
Â  Â  Â  Â  Â  Â  if (previousSelected) {
Â  Â  Â  Â  Â  Â  Â  previousSelected.classList.remove('selected-cell');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  target.classList.add('selected-cell');
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Nuevo listener para la navegaciÃ³n con la tecla Tab
Â  Â  Â  Â  tableElement.addEventListener('keydown', (event) => {
Â  Â  Â  Â  Â  if (event.key === 'Tab') {
Â  Â  Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  Â  Â  const celdasEditables = Array.from(document.querySelectorAll('td[contenteditable="true"]'));
Â  Â  Â  Â  Â  Â  const celdaActual = document.activeElement;
Â  Â  Â  Â  Â  Â  const currentIndex = celdasEditables.indexOf(celdaActual);

Â  Â  Â  Â  Â  Â  let nextIndex;
Â  Â  Â  Â  Â  Â  if (event.shiftKey) {
Â  Â  Â  Â  Â  Â  Â  // Shift+Tab (navegar hacia atrÃ¡s)
Â  Â  Â  Â  Â  Â  Â  nextIndex = (currentIndex > 0) ? currentIndex - 1 : celdasEditables.length - 1;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  // Tab (navegar hacia adelante)
Â  Â  Â  Â  Â  Â  Â  nextIndex = (currentIndex < celdasEditables.length - 1) ? currentIndex + 1 : 0;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  celdasEditables[nextIndex].focus();

Â  Â  Â  Â  Â  Â  // Quitar el resaltado de la celda anterior y aÃ±adirlo a la nueva
Â  Â  Â  Â  Â  Â  const previousSelected = document.querySelector('.selected-cell');
Â  Â  Â  Â  Â  Â  if (previousSelected) {
Â  Â  Â  Â  Â  Â  Â  previousSelected.classList.remove('selected-cell');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  celdasEditables[nextIndex].classList.add('selected-cell');
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("âŒ Error leyendo datos:", e);
Â  Â  Â  Â  document.getElementById("status-message").innerHTML = "<p>Error al leer datos. Revisa la consola para mÃ¡s detalles.</p>";
Â  Â  Â  }
Â  Â  }

Â  Â  async function guardarDatos() {
Â  Â  Â  document.getElementById("status-message").innerHTML = "Guardando cambios...";
Â  Â  Â  console.log("ğŸ’¾ Guardando datos en la hoja...");

Â  Â  Â  try {
Â  Â  Â  Â  const tabla = document.querySelector("#resultado table");
Â  Â  Â  Â  const filas = tabla.querySelectorAll("tbody tr");
Â  Â  Â  Â  const nuevosDatos = [];

Â  Â  Â  Â  filas.forEach(fila => {
Â  Â  Â  Â  Â  const celdas = fila.querySelectorAll("td");
Â  Â  Â  Â  Â  const nuevaFila = [];
Â  Â  Â  Â  Â  celdas.forEach(celda => {
Â  Â  Â  Â  Â  Â  nuevaFila.push(celda.innerText);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  nuevosDatos.push(nuevaFila);
Â  Â  Â  Â  });

Â  Â  Â  Â  const response = await gapi.client.sheets.spreadsheets.values.update({
Â  Â  Â  Â  Â  spreadsheetId: SPREADSHEET_ID,
Â  Â  Â  Â  Â  range: `Setembre25!A2:D${nuevosDatos.length + 1}`,
Â  Â  Â  Â  Â  valueInputOption: "USER_ENTERED",
Â  Â  Â  Â  Â  resource: {
Â  Â  Â  Â  Â  Â  values: nuevosDatos
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  console.log("âœ… Datos guardados:", response);
Â  Â  Â  Â  document.getElementById("status-message").innerHTML = "âœ… Cambios guardados con Ã©xito.";
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("âŒ Error guardando datos:", e);
Â  Â  Â  Â  document.getElementById("status-message").innerHTML = "<p>Error al guardar. Revisa la consola para mÃ¡s detalles.</p>";
Â  Â  Â  }
Â  Â  }

Â  Â  document.getElementById("login").onclick = login;
Â  Â  document.getElementById("logout").onclick = logout;
Â  Â  document.getElementById("save-button").onclick = guardarDatos;
Â  </script>
</body>
</html>



